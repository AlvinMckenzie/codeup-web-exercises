<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js"></script>

    <style>
        #map {
            width: 100%;
            height: 500px;
            border-radius: 25px;
            -webkit-border-radius: 25px;
        }

        #navbar {
            position: fixed;
            width: 100%;
            top: 0;
            overflow: hidden;
            z-index: 100;
        }

        #searchBar {
        }

        #weatherData{
            margin-top: 75px;
            background-color: lightgray;
        }

        #search {
            background-color: black;
        }



    </style>

</head>
<body>


<nav class="navbar bg-dark" id="navbar">
    <div class="container-fluid">
        <a class="navbar-brand text-light" href="#">
            <img src="img/snowflake_weather_app_icon_4x.webp" alt="Logo" width="35" height="30"
                 class="d-inline-block align-text-top">
            Weather App
        </a>
        <form class="d-flex" role="search">
            <input id="searchBar" class="form-control me-2" type="text" name="bar" placeholder="Search" aria-label="Search">
            <button id="search" class="btn btn-outline-success" type="submit">üîç</button>
        </form>
    </div>
</nav>

<div class="container" style="margin: auto">
    <div class="row">
    </div>
</div>

<div class="container ">
<div id="map" style="margin-top: 10px"></div>
</div>

<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>

<script src="js/mapbox-geocoder-utils.js"></script>

<script src="js/Api-keys.js"></script>

<script>

    let markerArr = []
    mapboxgl.accessToken = mapToken;
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v10',
        zoom: 13,
        center:[-95.40737, 30.11780]
    });

    let count = 5;

    $.ajax({
        url: "http://api.openweathermap.org/data/2.5/forecast",
        type: "GET",
        data: {
            APPID: weatherToken,
            lat: 30.11780,
            lon: -95.40737,
            units: 'imperial'
        }
    }).done(function (data) {
        // console.log(data)
        // console.log(data.list[0].dt_txt.split(' ')[0])
        // console.log(data.list[0].main. temp_max);
        // console.log(data.list[0].main.temp_min);
        // console.log(data.list[0].weather[0].icon);
        // console.log(data.list[0].weather[0].description);
        // console.log(data.list[0].main.humidity);
        // console.log(data.list[0].wind.speed);
        // console.log(data.list[0].main.pressure);

        //
        data.list.forEach(function (x) {
            if ((x.dt_txt.split(' ')[1] === '00:00:00') && (count > 0)) {
                // console.log(x.dt_txt.split(' ')[0])
                // console.log(x.main.temp_max);
                // console.log(x.main.temp_min);
                // console.log(x.weather[0].icon);
                // console.log(x.weather[0].description);
                // console.log(x.main.humidity);
                // console.log(x.wind.speed);
                // console.log(x.main.pressure);
                console.log(x)

                let html = '';
                html += '<div class="col card" id="weatherData"><p class="mb-4 card-header text-nowrap">' + x.dt_txt.split(' ')[0] + "</p>";
                html += '<p class="mb-2">' + (x.main.temp_min) + 'ÀöF' + ' / ' + (x.main.temp_max) + 'ÀöF' + '</p>';
                html += '<img src="http://openweathermap.org/img/w/' + x.weather[0].icon + '.png">'
                html += '<p class="mb-2">' + 'Desciption: ' + "<strong>" + x.weather[0].description + "</strong>" + '</p>';
                html += '<p class="mb-2">' + 'Humdidity: ' + x.main.humidity + '</p>';
                html += '<p class="mb-2"> ' + 'Wind: ' + x.wind.speed + '</p>';
                html += '<p>' + 'Pressure: ' + x.main.pressure + '</p>'
                html += '</div>';

                $('.row').append(html);

                count--


            }
        })
    })

    //Marker and Add marker function
    this.marker = new mapboxgl.Marker();
    this.map.on('click', this.addMarker.bind(this),
    );

    function addMarker(event) {

        var input = event.lngLat;

        this.marker.setLngLat(input).addTo(this.map);


        let count = 5;
        $.ajax({
            url: "http://api.openweathermap.org/data/2.5/forecast",
            type: "GET",
            data: {
                APPID: weatherToken,
                lat: input.lat,
                lon: input.lon,
                units: 'imperial'
            }
        }).done(function (data) {
            // console.log(data)
            $('#location').empty()
            let para = "";
            para += '<h3>' + data.city.name + ", " + data.city.country + '</h3>';
            $('#location').append(para)
            $('#data').empty()
            data.list.forEach(x => {
                if ((x.dt_txt.split(' ')[1] === '00:00:00') && (count > 0)) {

                    let html = "";

                    html += '<div class="col card-header"><p class="mb-4 card-header">' + x.dt_txt.split(' ')[0] + "</p>";
                    html += '<p class="mb-2">' + x.main.temp_min + 'F' + ' / ' + x.main.temp_max + 'F' + '</p>';
                    html += '<img src="http://openweathermap.org/img/w/' + x.weather[0].icon + '.png">'
                    html += '<p class="mb-2">' + 'Desciption: ' + "<strong>" + x.weather[0].description + "</strong>" + '</p>';
                    html += '<p class="mb-2">' + 'Humdidity: ' + x.main.humidity + '</p>';
                    html += '<p class="mb-2"> ' + 'Wind: ' + x.wind.speed + '</p>';
                    html += '<p>' + 'Pressure: ' + x.main.pressure + '</p>'
                    html += '</div>';

                    $('#data').append(html)
                    count--
                }
            })
        });
    }


    // Search bar event listener & search function
    let searchBar = document.getElementById('search');
    searchBar.addEventListener('click', searchLoc)

    let search = document.querySelector('form');
    searchBar.addEventListener('keydown', searchLoc)


    function searchLoc(e) {
        e.preventDefault()
        let input = document.getElementById('searchBar',).value;
        // console.log(input)
        geocode(input, mapToken).then(function (coordinates) {
            if (coordinates) {
                var marker = new mapboxgl.Marker()
                    .setLngLat(coordinates)
                    .addTo(map)
            }
            map.flyTo({center: coordinates});


            let count = 5;
            $.ajax({
                url: "http://api.openweathermap.org/data/2.5/forecast",
                type: "GET",
                data: {
                    APPID: weatherToken,
                    lat: coordinates[1],
                    lon: coordinates[0],
                    units: 'imperial'
                }
            }).done(function (data) {
                console.log(data)

                $('#location').empty()
                let para = "";
                para += '<h3>' + data.city.name + ", " + data.city.country + '</h3>';
                $('#location').append(para)
                $('#data').empty()

                data.list.forEach(x => {
                    if ((x.dt_txt.split(' ')[1] === '00:00:00') && (count > 0)) {

                        // console.log(x)

                        let html = "";

                        html += '<div class="col card-header"><p class="mb-4 card-header">' + x.dt_txt.split(' ')[0] + "</p>";
                        html += '<p class="mb-2">' + x.main.temp_min + 'F' + ' / ' + x.main.temp_max + 'F' + '</p>';
                        html += '<img src="http://openweathermap.org/img/w/' + x.weather[0].icon + '.png">'
                        html += '<p class="mb-2">' + 'Desciption: ' + "<strong>" + x.weather[0].description + "</strong>" + '</p>';
                        html += '<p class="mb-2">' + 'Humdidity: ' + x.main.humidity + '</p>';
                        html += '<p class="mb-2"> ' + 'Wind: ' + x.wind.speed + '</p>';
                        html += '<p>' + 'Pressure: ' + x.main.pressure + '</p>'
                        html += '</div>';

                        $('#data').append(html)
                        count--
                    }
                })
            });

        })
    }


</script>


</body>
</html>